# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a **Stonebranch Function Validator and Generator** web application that provides four main features:

1. **Function Validator** (`index.html`, `script.js`) - Validates Stonebranch function syntax with balanced bracket/quote checking
2. **Function Generator** (`generate.html`, `generate.js`) - Generates functions from text descriptions using Google AI Studio
3. **Function Explainer** (`explain.html`, `explain.js`) - Explains existing Stonebranch functions
4. **Function Fixer** (`fix.html`, `fix.js`) - Attempts to fix syntax errors in functions

## Architecture

### Frontend Structure
- **Static HTML pages** with individual JavaScript files for each feature
- **Shared CSS** (`styles.css`) for consistent styling
- **JSON configuration** (`functions.json`) containing Stonebranch function definitions and syntax
- **Client-side validation** with complex parsing logic for nested function calls

### Backend Integration
- **Netlify Functions** for serverless API endpoints (Google AI integration)
- **Environment variables** for secure API key management (`GOOGLE_AI_API_KEY`)

### Core Validation Logic (script.js)
- **Bracket/parentheses balance checking** with detailed error reporting
- **Quote balance validation** (single/double quotes with escape support)
- **Nested function call parsing** - detects underscore requirements based on `${}` nesting levels
- **Function name validation** against known Stonebranch functions
- **Context-aware underscore counting** (standalone vs brace-enclosed functions)

## Development Commands

### Local Development
```bash
# Install dependencies
npm install

# Start local development server with Netlify Functions
netlify dev
```

### Environment Setup
Create `.env` file with:
```
GOOGLE_AI_API_KEY=your_api_key_here
```

### Deployment
```bash
# Manual deployment
netlify deploy --prod
```

## Key Implementation Details

### Function Validation Algorithm
The validator uses a sophisticated multi-pass algorithm:
1. **Balance checking** for brackets/parentheses and quotes
2. **Function occurrence detection** using regex patterns
3. **Nesting level calculation** based on `${}` positions
4. **Underscore validation** - functions need 1+nesting_level underscores
5. **Error highlighting** with precise character-level positioning

### Function Syntax Format
Functions are stored in `functions.json` with canonical names starting with `_` (e.g., `_functionName`). The validator handles prefix variations (`_`, `__`, `___`) based on nesting context.

### Data Files
- `functions.json` - Function definitions and syntax help
- `get_functions.py` - Python scraper for extracting function docs from Stonebranch documentation
- `functions.txt`, `examples.txt`, `examples.json` - Additional reference data

## Important Notes

- No build process required - pure static files with Netlify Functions
- Function validation handles complex nested scenarios with string literal awareness
- Error messages include precise character positions for user feedback
- Cross-page navigation passes function data via URL parameters
- All API calls are proxied through Netlify Functions for security

## LLM-Generated Content Warning

**CRITICAL**: The Generate, Explain, and Fix pages use Google AI Studio (LLM) to provide content. All information generated by these features:
- **May contain errors or inaccuracies**
- **Should be carefully reviewed before use**
- **Is not guaranteed to be correct**
- **May not follow Stonebranch best practices**

Always validate LLM-generated functions using the Function Validator and verify against official Stonebranch documentation before using in production environments.